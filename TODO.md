# TODO

##########################
## User
##########################
* +Добавить признак для роли Reader
    rails generate migration add_reader_tag_to_users reader:boolean
    rails generate migration add_active_tag_to_users active:boolean

* +Добавить поля
    * Телефон
    * Комментарий
    rails generate migration add_data_fields_to_users phone:integer comment:string

* +Добавить форму для редактирования данных пользователя

* Добавить связи на order
    * User_ID
    * Reader_ID

* Добавить валидацию уникальности имени пользователя

##########################
## Заявки
##########################
* Шаблон
    ЗАВКА АГЕНТА НА ПРОДАЖУ УСЛУГИ
    1.ФИО абонента___________________________________________________________________
    2. паспортные данные: №______, серия_________________, дата рождения________________,
         Место рождения____________________, когда кем выдан_____________________________
    3. Адрес подключения_____________________________________________________________.
    4. Подключаемая услуга:
    o	ШПД  Тарифный план_______________________________________________________
                Оборудование: продажа/рассрочка на сколько месяцев__________________________
    o	IPTV    Тарифный план______________________________________________________
                Оборудование: продажа/рассрочка на сколько месяцев__________________________
    5. Контактный телефон: домашний и сотовый_________________________________________
    6. Предполагаемая дата подключения_______________________________________________
    7. ФИО Агента, подключившего услугу_______________________________________________
    8. ФИО Супервайзера Агента_______________________________________________________
    9. Дата продажи__________________________________________________________________

Пункты 1-6 заполняются на веб-странице при создании заявки.
Надо сразу предусмотреть защиту полей от ввода "мусора".
Пункт 7 - определяется по логину создающего заявку. Предполагается что это и есть агент.
Пункты 8-9 - атрибуты диспетчера выполнившего заявку, т.е. сделавшего на ее основе продажу в CRM.
Заполняется в момент перевода заявки в статус "Выполнено".
Или, при отмене заявки, заполняется ФИО диспетчера отменившего ее.

* Описание
    1. ФИО абонента                         *   abonent
    2. Паспортные данные:
        2.1. серия                          *   passport_series
        2.2. номер                          *   passport_number
        2.3. дата рождения                  *   date_of_birth   *   birthday    *   (dob)
        2.4. Место рождения                 *   place_of_birth  *   birthplace  *   (bpl)
        2.5. когда выдан                    *   passport_registration_date
        2.6. кем выдан                      *   passport_issued_by
    3. Адрес подключения                    *   address
    4. Подключаемая услуга
        4.1. Тарифный план ШПД              *   tariff_plan_inet
        4.2. Оборудование: продажа/рассрочка на сколько месяцев
                                            *   device_contract_inet
        4.3. Тарифный план IPTV             *   tariff_plan_iptv
        4.4. Оборудование: продажа/рассрочка на сколько месяцев
                                            *   device_contract_iptv
        4.5. Рассрочка на сколько месяцев   *   installment_plan_iptv
        4.6. Рассрочка на сколько месяцев   *   installment_plan_inet
    5. Контактный телефон:
        5.1. телефон домашний           *   phone
        5.2. телефон сотовый            *   phone_mobile
    6. Предполагаемая дата подключения  *   connection_date
    7. ФИО Агента, подключившего услугу *   writer
    8. ФИО Супервайзера Агента          *   reader
    9. Дата продажи                     *   contract_date
    10.Статус заявки (Новая/Принята/Отклонена)  *   order status

* +Добавить поля
        user_id:integer             "ID агента, подключившего услугу"
        reader_id:integer           "ID супервайзера агента"
        order_status:string
        contract_date:datetime

        abonent:string
        address:string
        phone:string
        phone_mobile:string

        connection_date:datetime
        inet_tariff_plan:string
        inet_device_contract:string
        inet_installment_plan:integer
        iptv_tariff_plan:string
        iptv_device_contract:string
        iptv_installment_plan:integer

        passport_series:string
        passport_number:string
        date_of_birth:datetime
        place_of_birth:string
        passport_registration_date:datetime
        passport_issued_by:string

        order_writer:               "ФИО агента, подключившего услугу"
        order_reader:               "ФИО супервайзера агента"

* +Добавить внешние ключи
    * +User_ID    (или Writer_ID)
    * +Reader_ID

* Добавить validates :reader_id должен быть заполнен user_id проверяющиго со статусом reader == true

* +Добавить индексы Заявки

* Добавить форму списка заявок для user

* Добавить форму редактирования полей заявки для Writer

* Добавить выбор для поля device_contract
    * аренда
    * продажа
    * рассрочка
    поле installment_plan доступно при выборе device_contract = рассрочка

* Добавить форму редактирования статуса заявки для Reader
    Переключатель статуса заявки
    * Новая
    * Принята
    * Отклонена

* Добавить перевод Заявки

##########################
## Администрирование
##########################
* +Добавить форму для смены пароля пользователю
    * Проверить валидацию пароля на форме сброса
* +Добавить функцию отправки писем со ссылкой для сброса пароля
    * +Добавить параметр кодировки для писем
* +Добавить признак Active для активации пользователя администратором
        rails generate migration add_active_tag_to_users active:boolean

* Добавить форму для администратора:
    переключатель признака активации пользователя Active true false
* Добавить форму для администратора
    * форма для смены пароля пользователя
    * в форме списка пользователей добавить переключатель автоматического сброса пароля и отправка на почту

##########################
## История
##########################
* История изменения заявки
* Лог авторизаций
    * User_ID
    * User_IP

##########################
## Роли
##########################
* Вынести роли в отдельную таблицу
    * Admin
    * Writer
    * Reader
* Назначение роли для пользователя

##########################
#### Пропустил, можно вернуться
Листинг 3.2. Динамическая генерация секретного токена.
config/initializers/secret_token.rb